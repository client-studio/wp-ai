(()=>{var e,t={408:e=>{e.exports=function(e,t){if("function"!=typeof e)throw new TypeError(`Expected the first argument to be a \`function\`, got \`${typeof e}\`.`);let n,o=0;return function(...a){clearTimeout(n);const r=Date.now(),s=t-(r-o);s<=0?(o=r,e.apply(this,a)):n=setTimeout(()=>{o=Date.now(),e.apply(this,a)},s)}}},493:(e,t,n)=>{"use strict";var o=n(609),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},r=o.useState,s=o.useEffect,l=o.useLayoutEffect,c=o.useDebugValue;function i(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!a(e,n)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),o=r({inst:{value:n,getSnapshot:t}}),a=o[0].inst,u=o[1];return l(function(){a.value=n,a.getSnapshot=t,i(a)&&u({inst:a})},[e,n,t]),s(function(){return i(a)&&u({inst:a}),e(function(){i(a)&&u({inst:a})})},[e]),c(n),n};t.useSyncExternalStore=void 0!==o.useSyncExternalStore?o.useSyncExternalStore:u},609:e=>{"use strict";e.exports=window.React},699:e=>{"use strict";const t="undefined"!=typeof Buffer,n=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,o=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function a(e,a,s){null==s&&null!==a&&"object"==typeof a&&(s=a,a=void 0),t&&Buffer.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));const l=JSON.parse(e,a);if(null===l||"object"!=typeof l)return l;const c=s&&s.protoAction||"error",i=s&&s.constructorAction||"error";if("ignore"===c&&"ignore"===i)return l;if("ignore"!==c&&"ignore"!==i){if(!1===n.test(e)&&!1===o.test(e))return l}else if("ignore"!==c&&"ignore"===i){if(!1===n.test(e))return l}else if(!1===o.test(e))return l;return r(l,{protoAction:c,constructorAction:i,safe:s&&s.safe})}function r(e,{protoAction:t="error",constructorAction:n="error",safe:o}={}){let a=[e];for(;a.length;){const e=a;a=[];for(const r of e){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(r,"__proto__")){if(!0===o)return null;if("error"===t)throw new SyntaxError("Object contains forbidden prototype property");delete r.__proto__}if("ignore"!==n&&Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype")){if(!0===o)return null;if("error"===n)throw new SyntaxError("Object contains forbidden prototype property");delete r.constructor}for(const e in r){const t=r[e];t&&"object"==typeof t&&a.push(t)}}}return e}function s(e,t,n){const o=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return a(e,t,n)}finally{Error.stackTraceLimit=o}}e.exports=s,e.exports.default=s,e.exports.parse=s,e.exports.safeParse=function(e,t){const n=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return a(e,t,{safe:!0})}catch(e){return null}finally{Error.stackTraceLimit=n}},e.exports.scan=r},888:(e,t,n)=>{"use strict";e.exports=n(493)},937:(e,t,n)=>{"use strict";const o=window.wp.element;var a,r=n(609),s="vercel.ai.error",l=Symbol.for(s),c=class e extends Error{constructor({name:e,message:t,cause:n}){super(t),this[a]=!0,this.name=e,this.cause=n}static isInstance(t){return e.hasMarker(t,s)}static hasMarker(e,t){const n=Symbol.for(t);return null!=e&&"object"==typeof e&&n in e&&"boolean"==typeof e[n]&&!0===e[n]}toJSON(){return{name:this.name,message:this.message}}};a=l;var i,u=c,d=(Symbol.for("vercel.ai.error.AI_APICallError"),Symbol.for("vercel.ai.error.AI_EmptyResponseBodyError"),"AI_InvalidArgumentError"),f=`vercel.ai.error.${d}`,p=Symbol.for(f),m=class extends u{constructor({message:e,cause:t,argument:n}){super({name:d,message:e,cause:t}),this[i]=!0,this.argument=n}static isInstance(e){return u.hasMarker(e,f)}};i=p;Symbol.for("vercel.ai.error.AI_InvalidPromptError"),Symbol.for("vercel.ai.error.AI_InvalidResponseDataError"),Symbol.for("vercel.ai.error.AI_JSONParseError"),Symbol.for("vercel.ai.error.AI_LoadAPIKeyError"),Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),Symbol.for("vercel.ai.error.AI_NoSuchModelError"),Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError"),Symbol.for("vercel.ai.error.AI_TypeValidationError"),Symbol.for("vercel.ai.error.AI_UnsupportedFunctionalityError");var h=n(699),g=(({prefix:e,size:t=7,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:o="-"}={})=>{const a=((e,t=21)=>(n=t)=>{let o="",a=0|n;for(;a--;)o+=e[Math.random()*e.length|0];return o})(n,t);if(null==e)return a;if(n.includes(o))throw new m({argument:"separator",message:`The separator "${o}" must not be part of the alphabet "${n}".`});return t=>`${e}${o}${a(t)}`})();Symbol.for("vercel.ai.validator");var{btoa:_,atob:y}=globalThis;function E(e){const t=["ROOT"];let n=-1,o=null;function a(e,a,r){switch(e){case'"':n=a,t.pop(),t.push(r),t.push("INSIDE_STRING");break;case"f":case"t":case"n":n=a,o=a,t.pop(),t.push(r),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(r),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n=a,t.pop(),t.push(r),t.push("INSIDE_NUMBER");break;case"{":n=a,t.pop(),t.push(r),t.push("INSIDE_OBJECT_START");break;case"[":n=a,t.pop(),t.push(r),t.push("INSIDE_ARRAY_START")}}function r(e,o){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":n=o,t.pop()}}function s(e,o){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":n=o,t.pop()}}for(let l=0;l<e.length;l++){const c=e[l];switch(t[t.length-1]){case"ROOT":a(c,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(c){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":n=l,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===c&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===c&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===c&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":a(c,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":r(c,l);break;case"INSIDE_STRING":switch(c){case'"':t.pop(),n=l;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:n=l}break;case"INSIDE_ARRAY_START":"]"===c?(n=l,t.pop()):(n=l,a(c,l,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(c){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":n=l,t.pop();break;default:n=l}break;case"INSIDE_ARRAY_AFTER_COMMA":a(c,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),n=l;break;case"INSIDE_NUMBER":switch(c){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n=l;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(c,l),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&r(c,l);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&r(c,l);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(c,l);break;default:t.pop()}break;case"INSIDE_LITERAL":{const a=e.substring(o,l+1);"false".startsWith(a)||"true".startsWith(a)||"null".startsWith(a)?n=l:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?r(c,l):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(c,l));break}}}let l=e.slice(0,n+1);for(let n=t.length-1;n>=0;n--)switch(t[n]){case"INSIDE_STRING":l+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":l+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":l+="]";break;case"INSIDE_LITERAL":{const t=e.substring(o,e.length);"true".startsWith(t)?l+="true".slice(t.length):"false".startsWith(t)?l+="false".slice(t.length):"null".startsWith(t)&&(l+="null".slice(t.length))}}return l}function b(e){if(void 0===e)return{value:void 0,state:"undefined-input"};try{return{value:h.parse(e),state:"successful-parse"}}catch(t){try{return{value:h.parse(E(e)),state:"repaired-parse"}}catch(e){}}return{value:void 0,state:"failed-parse"}}Symbol("Let zodToJsonSchema decide on which parser to use"),new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");var v={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},w={code:"1",name:"function_call",parse:e=>{if(null==e||"object"!=typeof e||!("function_call"in e)||"object"!=typeof e.function_call||null==e.function_call||!("name"in e.function_call)||!("arguments"in e.function_call)||"string"!=typeof e.function_call.name||"string"!=typeof e.function_call.arguments)throw new Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},I={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},k={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},x={code:"4",name:"assistant_message",parse:e=>{if(!(null!=e&&"object"==typeof e&&"id"in e&&"role"in e&&"content"in e&&"string"==typeof e.id&&"string"==typeof e.role&&"assistant"===e.role&&Array.isArray(e.content)&&e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value)))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},A={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},S={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},C={code:"7",name:"tool_calls",parse:e=>{if(null==e||"object"!=typeof e||!("tool_calls"in e)||"object"!=typeof e.tool_calls||null==e.tool_calls||!Array.isArray(e.tool_calls)||e.tool_calls.some(e=>!(null!=e&&"object"==typeof e&&"id"in e&&"string"==typeof e.id&&"type"in e&&"string"==typeof e.type&&"function"in e&&null!=e.function&&"object"==typeof e.function&&"arguments"in e.function&&"string"==typeof e.function.name&&"string"==typeof e.function.arguments)))throw new Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:e}}},T={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},N={code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},R={code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},O={code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},D={code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},L={code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},j={code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&"boolean"==typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},F=[v,w,I,k,x,A,S,C,T,N,R,O,D,L,j],M={[v.code]:v,[w.code]:w,[I.code]:I,[k.code]:k,[x.code]:x,[A.code]:A,[S.code]:S,[C.code]:C,[T.code]:T,[N.code]:N,[R.code]:R,[O.code]:O,[D.code]:D,[L.code]:L,[j.code]:j},B=F.map(e=>e.code),P=e=>{const t=e.indexOf(":");if(-1===t)throw new Error("Failed to parse stream string. No separator found.");const n=e.slice(0,t);if(!B.includes(n))throw new Error(`Failed to parse stream string. Invalid code ${n}.`);const o=n,a=e.slice(t+1),r=JSON.parse(a);return M[o].parse(r)},V="\n".charCodeAt(0);function J(e,t){const n=new Uint8Array(t);let o=0;for(const t of e)n.set(t,o),o+=t.length;return e.length=0,n}function U(e,t){return e&&t&&t.length?{...e,annotations:[...t]}:e}var W=()=>fetch;async function Y({api:e,body:t,streamProtocol:n="data",credentials:o,headers:a,abortController:r,restoreMessagesOnFailure:s,onResponse:l,onUpdate:c,onFinish:i,onToolCall:u,generateId:d,fetch:f=W()}){var p,m;const h=await f(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",...a},signal:null==(p=null==r?void 0:r())?void 0:p.signal,credentials:o}).catch(e=>{throw s(),e});if(l)try{await l(h)}catch(e){throw e}if(!h.ok)throw s(),new Error(null!=(m=await h.text())?m:"Failed to fetch the chat response.");if(!h.body)throw new Error("The response body is empty.");const _=h.body.getReader();switch(n){case"text":{const e=function(e){const t=new TextDecoder;return e?function(e){return t.decode(e,{stream:!0}).split("\n").filter(e=>""!==e).map(P).filter(Boolean)}:function(e){return e?t.decode(e,{stream:!0}):""}}(),t={id:d(),createdAt:new Date,role:"assistant",content:""};for(;;){const{done:n,value:o}=await _.read();if(n)break;if(t.content+=e(o),c([{...t}],[]),null===(null==r?void 0:r())){_.cancel();break}}return null==i||i(t,{usage:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},finishReason:"unknown"}),{messages:[t],data:[]}}case"data":return await async function({reader:e,abortControllerRef:t,update:n,onToolCall:o,onFinish:a,generateId:r=g,getCurrentDate:s=()=>new Date}){var l;const c=s();let i,u={};const d=[],f=[];let p;const m={};let h={completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},_="unknown";for await(const{type:a,value:s}of async function*(e,{isAborted:t}={}){const n=new TextDecoder,o=[];let a=0;for(;;){const{value:r}=await e.read();if(r&&(o.push(r),a+=r.length,r[r.length-1]!==V))continue;if(0===o.length)break;const s=J(o,a);a=0;const l=n.decode(s,{stream:!0}).split("\n").filter(e=>""!==e).map(P);for(const e of l)yield e;if(null==t?void 0:t()){e.cancel();break}}}(e,{isAborted:()=>null===(null==t?void 0:t.current)})){if("error"===a)throw new Error(s);if("finish_step"===a){s.isContinued||(i={});continue}if("finish_message"===a){if(_=s.finishReason,null!=s.usage){const{completionTokens:e,promptTokens:t}=s.usage;h={completionTokens:e,promptTokens:t,totalTokens:e+t}}continue}if(null==i||"text"!==a&&"tool_call"!==a&&"tool_call_streaming_start"!==a&&"tool_call_delta"!==a&&"tool_result"!==a||(u.text&&d.push(u.text),u.function_call&&d.push(u.function_call),u.tool_calls&&d.push(u.tool_calls),u=i,i=void 0),"text"===a&&(u.text?u.text={...u.text,content:(u.text.content||"")+s}:u.text={id:r(),role:"assistant",content:s,createdAt:c}),"tool_call_streaming_start"===a)null==u.text&&(u.text={id:r(),role:"assistant",content:"",createdAt:c}),null==u.text.toolInvocations&&(u.text.toolInvocations=[]),m[s.toolCallId]={text:"",toolName:s.toolName,prefixMapIndex:u.text.toolInvocations.length},u.text.toolInvocations.push({state:"partial-call",toolCallId:s.toolCallId,toolName:s.toolName,args:void 0});else if("tool_call_delta"===a){const e=m[s.toolCallId];e.text+=s.argsTextDelta;const{value:t}=b(e.text);u.text.toolInvocations[e.prefixMapIndex]={state:"partial-call",toolCallId:s.toolCallId,toolName:e.toolName,args:t},u.text.internalUpdateId=r()}else if("tool_call"===a){if(null!=m[s.toolCallId]?u.text.toolInvocations[m[s.toolCallId].prefixMapIndex]={state:"call",...s}:(null==u.text&&(u.text={id:r(),role:"assistant",content:"",createdAt:c}),null==u.text.toolInvocations&&(u.text.toolInvocations=[]),u.text.toolInvocations.push({state:"call",...s})),u.text.internalUpdateId=r(),o){const e=await o({toolCall:s});null!=e&&(u.text.toolInvocations[u.text.toolInvocations.length-1]={state:"result",...s,result:e})}}else if("tool_result"===a){const e=null==(l=u.text)?void 0:l.toolInvocations;if(null==e)throw new Error("tool_result must be preceded by a tool_call");const t=e.findIndex(e=>e.toolCallId===s.toolCallId);if(-1===t)throw new Error("tool_result must be preceded by a tool_call with the same toolCallId");e[t]={...e[t],state:"result",...s}}let e=null;"function_call"===a&&(u.function_call={id:r(),role:"assistant",content:"",function_call:s.function_call,name:s.function_call.name,createdAt:c},e=u.function_call);let t=null;"tool_calls"===a&&(u.tool_calls={id:r(),role:"assistant",content:"",tool_calls:s.tool_calls,createdAt:c},t=u.tool_calls),"data"===a&&f.push(...s);let g=u.text;"message_annotations"===a&&(p?p.push(...s):p=[...s],e=U(u.function_call,p),t=U(u.tool_calls,p),g=U(u.text,p),null!=u.text&&(u.text.internalUpdateId=r())),(null==p?void 0:p.length)&&(u.text&&(u.text.annotations=[...p]),u.function_call&&(u.function_call.annotations=[...p]),u.tool_calls&&(u.tool_calls.annotations=[...p]));const y=[e,t,g].filter(Boolean).map(e=>({...U(e,p)}));n([...d,...y],[...f])}return null==a||a({message:u.text,finishReason:_,usage:h}),{messages:[u.text,u.function_call,u.tool_calls].filter(Boolean),data:f}}({reader:_,abortControllerRef:null!=r?{current:r()}:void 0,update:c,onToolCall:u,onFinish({message:e,finishReason:t,usage:n}){i&&null!=e&&i(e,{usage:n,finishReason:t})},generateId:d});default:throw new Error(`Unknown stream protocol: ${n}`)}}Symbol.for("vercel.ai.schema");var $=n(888),q=Object.prototype.hasOwnProperty;const K=new WeakMap,z=()=>{},G=z(),H=Object,Q=e=>e===G,X=e=>"function"==typeof e,Z=(e,t)=>({...e,...t}),ee=e=>X(e.then),te={},ne={},oe="undefined",ae=typeof window!=oe,re=typeof document!=oe,se=ae&&"Deno"in window,le=(e,t)=>{const n=K.get(e);return[()=>!Q(t)&&e.get(t)||te,o=>{if(!Q(t)){const a=e.get(t);t in ne||(ne[t]=a),n[5](t,Z(a,o),a||te)}},n[6],()=>!Q(t)&&t in ne?ne[t]:!Q(t)&&e.get(t)||te]};let ce=!0;const[ie,ue]=ae&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[z,z],de={isOnline:()=>ce,isVisible:()=>{const e=re&&document.visibilityState;return Q(e)||"hidden"!==e}},fe={initFocus:e=>(re&&document.addEventListener("visibilitychange",e),ie("focus",e),()=>{re&&document.removeEventListener("visibilitychange",e),ue("focus",e)}),initReconnect:e=>{const t=()=>{ce=!0,e()},n=()=>{ce=!1};return ie("online",t),ie("offline",n),()=>{ue("online",t),ue("offline",n)}}},pe=!r.useId,me=!ae||se,he=me?r.useEffect:r.useLayoutEffect,ge="undefined"!=typeof navigator&&navigator.connection,_e=!me&&ge&&(["slow-2g","2g"].includes(ge.effectiveType)||ge.saveData),ye=new WeakMap,Ee=(e,t)=>e===`[object ${t}]`;let be=0;const ve=e=>{const t=typeof e,n=(o=e,H.prototype.toString.call(o));var o;const a=Ee(n,"Date"),r=Ee(n,"RegExp"),s=Ee(n,"Object");let l,c;if(H(e)!==e||a||r)l=a?e.toJSON():"symbol"==t?e.toString():"string"==t?JSON.stringify(e):""+e;else{if(l=ye.get(e),l)return l;if(l=++be+"~",ye.set(e,l),Array.isArray(e)){for(l="@",c=0;c<e.length;c++)l+=ve(e[c])+",";ye.set(e,l)}if(s){l="#";const t=H.keys(e).sort();for(;!Q(c=t.pop());)Q(e[c])||(l+=c+":"+ve(e[c])+",");ye.set(e,l)}}return l},we=e=>{if(X(e))try{e=e()}catch(t){e=""}const t=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?ve(e):"",t]};let Ie=0;const ke=()=>++Ie;async function xe(...e){const[t,n,o,a]=e,r=Z({populateCache:!0,throwOnError:!0},"boolean"==typeof a?{revalidate:a}:a||{});let s=r.populateCache;const l=r.rollbackOnError;let c=r.optimisticData;const i=r.throwOnError;if(X(n)){const e=n,o=[],a=t.keys();for(const n of a)!/^\$(inf|sub)\$/.test(n)&&e(t.get(n)._k)&&o.push(n);return Promise.all(o.map(u))}return u(n);async function u(n){const[a]=we(n);if(!a)return;const[u,d]=le(t,a),[f,p,m,h]=K.get(t),g=()=>{const e=f[a];return(X(r.revalidate)?r.revalidate(u().data,n):!1!==r.revalidate)&&(delete m[a],delete h[a],e&&e[0])?e[0](2).then(()=>u().data):u().data};if(e.length<3)return g();let _,y=o,E=!1;const b=ke();p[a]=[b,0];const v=!Q(c),w=u(),I=w.data,k=w._c,x=Q(k)?I:k;if(v&&(c=X(c)?c(x,I):c,d({data:c,_c:x})),X(y))try{y=y(x)}catch(e){_=e,E=!0}if(y&&ee(y)){if(y=await y.catch(e=>{_=e,E=!0}),b!==p[a][0]){if(E)throw _;return y}E&&v&&(e=>"function"==typeof l?l(e):!1!==l)(_)&&(s=!0,d({data:x,_c:G}))}if(s&&!E)if(X(s)){const e=s(y,x);d({data:e,error:G,_c:G})}else d({data:y,error:G,_c:G});if(p[a][1]=ke(),Promise.resolve(g()).then(()=>{d({_c:G})}),!E)return y;if(i)throw _}}const Ae=(e,t)=>{for(const n in e)e[n][0]&&e[n][0](t)},Se=(e,t)=>{if(!K.has(e)){const n=Z(fe,t),o=Object.create(null),a=xe.bind(G,e);let r=z;const s=Object.create(null),l=(e,t)=>{const n=s[e]||[];return s[e]=n,n.push(t),()=>n.splice(n.indexOf(t),1)},c=(t,n,o)=>{e.set(t,n);const a=s[t];if(a)for(const e of a)e(n,o)},i=()=>{if(!K.has(e)&&(K.set(e,[o,Object.create(null),Object.create(null),Object.create(null),a,c,l]),!me)){const t=n.initFocus(setTimeout.bind(G,Ae.bind(G,o,0))),a=n.initReconnect(setTimeout.bind(G,Ae.bind(G,o,1)));r=()=>{t&&t(),a&&a(),K.delete(e)}}};return i(),[e,a,i,r]}return[e,K.get(e)[4]]},[Ce,Te]=Se(new Map),Ne=Z({onLoadingSlow:z,onSuccess:z,onError:z,onErrorRetry:(e,__,t,n,o)=>{const a=t.errorRetryCount,r=o.retryCount,s=~~((Math.random()+.5)*(1<<(r<8?r:8)))*t.errorRetryInterval;!Q(a)&&r>a||setTimeout(n,s,o)},onDiscarded:z,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:_e?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:_e?5e3:3e3,compare:function e(t,n){var o,a;if(t===n)return!0;if(t&&n&&(o=t.constructor)===n.constructor){if(o===Date)return t.getTime()===n.getTime();if(o===RegExp)return t.toString()===n.toString();if(o===Array){if((a=t.length)===n.length)for(;a--&&e(t[a],n[a]););return-1===a}if(!o||"object"==typeof t){for(o in a=0,t){if(q.call(t,o)&&++a&&!q.call(n,o))return!1;if(!(o in n)||!e(t[o],n[o]))return!1}return Object.keys(n).length===a}}return t!=t&&n!=n},isPaused:()=>!1,cache:Ce,mutate:Te,fallback:{}},de),Re=(e,t)=>{const n=Z(e,t);if(t){const{use:o,fallback:a}=e,{use:r,fallback:s}=t;o&&r&&(n.use=o.concat(r)),a&&s&&(n.fallback=Z(a,s))}return n},Oe=(0,r.createContext)({}),De=ae&&window.__SWR_DEVTOOLS_USE__,Le=De?window.__SWR_DEVTOOLS_USE__:[],je=Le.concat(e=>(t,n,o)=>e(t,n&&((...e)=>{const[o]=we(t),[,,,a]=K.get(Ce);if(o.startsWith("$inf$"))return n(...e);const r=a[o];return Q(r)?n(...e):(delete a[o],r)}),o));De&&(window.__SWR_DEVTOOLS_REACT__=r);const Fe=()=>{};Fe(),new WeakMap;const Me=r.use||(e=>{switch(e.status){case"pending":throw e;case"fulfilled":return e.value;case"rejected":throw e.reason;default:throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e}}),Be={dedupe:!0},Pe=Promise.resolve(G),Ve=(H.defineProperty(e=>{const{value:t}=e,n=(0,r.useContext)(Oe),o=X(t),a=(0,r.useMemo)(()=>o?t(n):t,[o,n,t]),s=(0,r.useMemo)(()=>o?a:Re(n,a),[o,n,a]),l=a&&a.provider,c=(0,r.useRef)(G);l&&!c.current&&(c.current=Se(l(s.cache||Ce),a));const i=c.current;return i&&(s.cache=i[0],s.mutate=i[1]),he(()=>{if(i)return i[2]&&i[2](),i[3]},[]),(0,r.createElement)(Oe.Provider,Z(e,{value:s}))},"defaultValue",{value:Ne}),Je=(e,t,n)=>{const{cache:o,compare:a,suspense:s,fallbackData:l,revalidateOnMount:c,revalidateIfStale:i,refreshInterval:u,refreshWhenHidden:d,refreshWhenOffline:f,keepPreviousData:p}=n,[m,h,g,_]=K.get(o),[y,E]=we(e),b=(0,r.useRef)(!1),v=(0,r.useRef)(!1),w=(0,r.useRef)(y),I=(0,r.useRef)(t),k=(0,r.useRef)(n),x=()=>k.current,A=()=>x().isVisible()&&x().isOnline(),[S,C,T,N]=le(o,y),R=(0,r.useRef)({}).current,O=Q(l)?Q(n.fallback)?G:n.fallback[y]:l,D=(e,t)=>{for(const n in R){const o=n;if("data"===o){if(!a(e[o],t[o])){if(!Q(e[o]))return!1;if(!a(U,t[o]))return!1}}else if(t[o]!==e[o])return!1}return!0},L=(0,r.useMemo)(()=>{const e=!!y&&!!t&&(Q(c)?!x().isPaused()&&!s&&!1!==i:c),n=t=>{const n=Z(t);return delete n._k,e?{isValidating:!0,isLoading:!0,...n}:n},o=S(),a=N(),r=n(o),l=o===a?r:n(a);let u=r;return[()=>{const e=n(S());return D(e,u)?(u.data=e.data,u.isLoading=e.isLoading,u.isValidating=e.isValidating,u.error=e.error,u):(u=e,e)},()=>l]},[o,y]),j=(0,$.useSyncExternalStore)((0,r.useCallback)(e=>T(y,(t,n)=>{D(n,t)||e()}),[o,y]),L[0],L[1]),F=!b.current,M=m[y]&&m[y].length>0,B=j.data,P=Q(B)?O&&ee(O)?Me(O):O:B,V=j.error,J=(0,r.useRef)(P),U=p?Q(B)?Q(J.current)?P:J.current:B:P,W=!(M&&!Q(V))&&(F&&!Q(c)?c:!x().isPaused()&&(s?!Q(P)&&i:Q(P)||i)),Y=!!(y&&t&&F&&W),q=Q(j.isValidating)?Y:j.isValidating,z=Q(j.isLoading)?Y:j.isLoading,H=(0,r.useCallback)(async e=>{const t=I.current;if(!y||!t||v.current||x().isPaused())return!1;let o,r,s=!0;const l=e||{},c=!g[y]||!l.dedupe,i=()=>pe?!v.current&&y===w.current&&b.current:y===w.current,u={isValidating:!1,isLoading:!1},d=()=>{C(u)},f=()=>{const e=g[y];e&&e[1]===r&&delete g[y]},p={isValidating:!0};Q(S().data)&&(p.isLoading=!0);try{if(c&&(C(p),n.loadingTimeout&&Q(S().data)&&setTimeout(()=>{s&&i()&&x().onLoadingSlow(y,n)},n.loadingTimeout),g[y]=[t(E),ke()]),[o,r]=g[y],o=await o,c&&setTimeout(f,n.dedupingInterval),!g[y]||g[y][1]!==r)return c&&i()&&x().onDiscarded(y),!1;u.error=G;const e=h[y];if(!Q(e)&&(r<=e[0]||r<=e[1]||0===e[1]))return d(),c&&i()&&x().onDiscarded(y),!1;const l=S().data;u.data=a(l,o)?l:o,c&&i()&&x().onSuccess(o,y,n)}catch(e){f();const t=x(),{shouldRetryOnError:n}=t;t.isPaused()||(u.error=e,c&&i()&&(t.onError(e,y,t),(!0===n||X(n)&&n(e))&&(x().revalidateOnFocus&&x().revalidateOnReconnect&&!A()||t.onErrorRetry(e,y,t,e=>{const t=m[y];t&&t[0]&&t[0](3,e)},{retryCount:(l.retryCount||0)+1,dedupe:!0}))))}return s=!1,d(),!0},[y,o]),te=(0,r.useCallback)((...e)=>xe(o,w.current,...e),[]);if(he(()=>{I.current=t,k.current=n,Q(B)||(J.current=B)}),he(()=>{if(!y)return;const e=H.bind(G,Be);let t=0;if(x().revalidateOnFocus){const e=Date.now();t=e+x().focusThrottleInterval}const n=((e,t,n)=>{const o=t[e]||(t[e]=[]);return o.push(n),()=>{const e=o.indexOf(n);e>=0&&(o[e]=o[o.length-1],o.pop())}})(y,m,(n,o={})=>{if(0==n){const n=Date.now();x().revalidateOnFocus&&n>t&&A()&&(t=n+x().focusThrottleInterval,e())}else if(1==n)x().revalidateOnReconnect&&A()&&e();else{if(2==n)return H();if(3==n)return H(o)}});return v.current=!1,w.current=y,b.current=!0,C({_k:E}),W&&(g[y]||(Q(P)||me?e():(o=e,ae&&typeof window.requestAnimationFrame!=oe?window.requestAnimationFrame(o):setTimeout(o,1)))),()=>{v.current=!0,n()};var o},[y]),he(()=>{let e;function t(){const t=X(u)?u(S().data):u;t&&-1!==e&&(e=setTimeout(n,t))}function n(){S().error||!d&&!x().isVisible()||!f&&!x().isOnline()?t():H(Be).then(t)}return t(),()=>{e&&(clearTimeout(e),e=-1)}},[u,d,f,y]),(0,r.useDebugValue)(U),s){const e=y&&Q(P);if(!pe&&me&&e)throw new Error("Fallback data is required when using Suspense in SSR.");e&&(I.current=t,k.current=n,v.current=!1);const o=_[y],a=!Q(o)&&e?te(o):Pe;if(Me(a),!Q(V)&&e)throw V;const r=e?H(Be):Pe;!Q(U)&&e&&(r.status="fulfilled",r.value=!0),Me(r)}return{mutate:te,get data(){return R.data=!0,U},get error(){return R.error=!0,V},get isValidating(){return R.isValidating=!0,q},get isLoading(){return R.isLoading=!0,z}}},function(...e){const t=(()=>{const e=(0,r.useContext)(Oe);return(0,r.useMemo)(()=>Z(Ne,e),[e])})(),[n,o,a]=(e=>X(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}])(e),s=Re(t,a);let l=Je;const{use:c}=s,i=(c||[]).concat(je);for(let e=i.length;e--;)l=i[e](l);return l(n,o||s.fetcher||null,s)});var Je,Ue=n(408);function We(e,t){return null!=t?Ue(e,t):e}function Ye(e){return"assistant"===e.role&&e.toolInvocations&&e.toolInvocations.length>0&&e.toolInvocations.every(e=>"result"in e)}async function $e(e){if(null==e)return[];if(e instanceof FileList)return Promise.all(Array.from(e).map(async e=>{const{name:t,type:n}=e,o=await new Promise((t,n)=>{const o=new FileReader;o.onload=e=>{var n;t(null==(n=e.target)?void 0:n.result)},o.onerror=e=>n(e),o.readAsDataURL(e)});return{name:t,contentType:n,url:o}}));if(Array.isArray(e))return e;throw new Error("Invalid attachments type")}const qe="none",Ke="single",ze="page";function Ge({role:e,content:t}){return(0,o.createElement)("div",{className:`cae-message cae-message-${e}`},(0,o.createElement)("div",{className:"cae-message-content"},t))}function He({messages:e,isLoading:t}){const n=(0,o.useRef)(null);return(0,o.useEffect)(()=>{n.current?.scrollIntoView({behavior:"smooth"})},[e,t]),(0,o.createElement)("div",{className:"cae-messages"},(0,o.createElement)("div",{className:"cae-message cae-message-system"},(0,o.createElement)("div",{className:"cae-message-content"},(0,o.createElement)("p",null,"👋 Hello! I can help you edit your content."),(0,o.createElement)("p",null,(0,o.createElement)("strong",null,"Quick tips:")),(0,o.createElement)("ul",null,(0,o.createElement)("li",null,'Click a block to select it, or use "Full Page" mode'),(0,o.createElement)("li",null,"Tell me what you want to change"),(0,o.createElement)("li",null,"Review the changes before applying")))),e.map(e=>(0,o.createElement)(Ge,{key:e.id,role:e.role,content:e.content})),t&&(0,o.createElement)("div",{className:"cae-message cae-message-loading"},(0,o.createElement)("div",{className:"cae-message-content"},(0,o.createElement)("div",{className:"cae-typing-indicator"},(0,o.createElement)("span",null),(0,o.createElement)("span",null),(0,o.createElement)("span",null)),(0,o.createElement)("span",null,"Thinking..."))),(0,o.createElement)("div",{ref:n}))}function Qe({value:e,onChange:t,onSubmit:n,disabled:a,isLoading:r}){const s=t=>{t.preventDefault(),a||r||!e.trim()||n(t)};return(0,o.createElement)("div",{className:"cae-input-container"},(0,o.createElement)("form",{onSubmit:s},(0,o.createElement)("textarea",{className:"cae-input",placeholder:a?"Select a block or enable Full Page mode first...":"Type your editing instructions...",rows:3,value:e,onChange:e=>t(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),s(e))},disabled:a}),(0,o.createElement)("button",{type:"submit",className:"cae-send-btn",disabled:a||r||!e.trim(),"aria-label":"Send"},(0,o.createElement)("svg",{width:20,height:20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2},(0,o.createElement)("path",{d:"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"})))))}function Xe({targetBlock:e,targetMode:t,onSetPageMode:n}){const a=t!==qe,r=t===ze,s=window.CAE_Data?.languageName||null;let l="No block selected";return r?l="Full Page Mode":e&&(l=`Block ${e.index+1}: ${e.layout}`),s&&(l+=` • ${s}`),(0,o.createElement)("div",{className:"cae-target-indicator "+(a?"cae-has-target":"")},(0,o.createElement)("svg",{width:16,height:16,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2},(0,o.createElement)("circle",{cx:12,cy:12,r:10}),(0,o.createElement)("circle",{cx:12,cy:12,r:6}),(0,o.createElement)("circle",{cx:12,cy:12,r:2})),(0,o.createElement)("span",{className:"cae-target-text"},l),(0,o.createElement)("button",{className:"cae-target-page-btn "+(r?"active":""),onClick:n,title:"Edit full page"},(0,o.createElement)("svg",{width:14,height:14,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2},(0,o.createElement)("rect",{x:3,y:3,width:18,height:18,rx:2}))," Full Page"))}function Ze({changes:e,currentData:t,postId:n,onClose:a,onApply:r}){const[s,l]=(0,o.useState)(!1);if(!e)return null;const c=(e,t,n)=>(0,o.createElement)("div",{className:"cae-diff-field",key:e},(0,o.createElement)("div",{className:"cae-diff-field-name"},e),(0,o.createElement)("div",{className:"cae-diff-comparison"},(0,o.createElement)("div",{className:"cae-diff-side cae-diff-old"},(0,o.createElement)("div",{className:"cae-diff-side-label"},"Before"),(0,o.createElement)("div",{className:"cae-diff-side-content"},t||"(empty)")),(0,o.createElement)("div",{className:"cae-diff-side cae-diff-new"},(0,o.createElement)("div",{className:"cae-diff-side-label"},"After (AI)"),(0,o.createElement)("div",{className:"cae-diff-side-content"},n||"(empty)"))));return(0,o.createElement)("div",{className:"cae-diff-modal active"},(0,o.createElement)("div",{className:"cae-diff-dialog"},(0,o.createElement)("div",{className:"cae-diff-header"},(0,o.createElement)("h3",null,"Review AI Changes"),(0,o.createElement)("button",{className:"cae-diff-close",onClick:a},(0,o.createElement)("svg",{width:20,height:20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2},(0,o.createElement)("path",{d:"M18 6L6 18M6 6l12 12"})))),(0,o.createElement)("div",{className:"cae-diff-content"},e.modules?e.modules.map((e,n)=>(0,o.createElement)("div",{key:n,className:"cae-diff-module-group"},(0,o.createElement)("h4",{className:"cae-diff-module-title"},`Module #${e.index}`),Object.keys(e.fields||{}).map(n=>c(n,t?.[e.index]?.[n]||"",e.fields[n])))):Object.keys(e.fields||{}).map(n=>c(n,t?.[n]||"",e.fields[n]))),(0,o.createElement)("div",{className:"cae-diff-footer"},(0,o.createElement)("div",{className:"cae-diff-info"},e.modules?`${e.modules.reduce((e,t)=>e+Object.keys(t.fields||{}).length,0)} change(s) across ${e.modules.length} module(s)`:`${Object.keys(e.fields||{}).length} change(s) detected`),(0,o.createElement)("div",{className:"cae-diff-actions"},(0,o.createElement)("button",{className:"cae-diff-btn cae-diff-btn-cancel",onClick:a,disabled:s},"Cancel"),(0,o.createElement)("button",{className:"cae-diff-btn cae-diff-btn-apply",onClick:async()=>{l(!0);try{await r(e),a()}catch(e){console.error("Failed to apply changes:",e),alert("Failed to apply changes. Please try again.")}finally{l(!1)}},disabled:s},(0,o.createElement)("svg",{width:16,height:16,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2},(0,o.createElement)("polyline",{points:"20 6 9 17 4 12"})),s?"Applying...":"Apply Changes")))))}async function et(e,t={}){const n=new FormData;return n.append("action",e),n.append("nonce",window.CAE_Data?.nonce||""),Object.keys(t).forEach(e=>{"object"==typeof t[e]?n.append(e,JSON.stringify(t[e])):n.append(e,t[e])}),(await fetch(window.CAE_Data?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:n})).json()}async function tt(e,t){return et("cae_get_block",{post_id:e,block_index:t})}function nt(){const[e,t]=(0,o.useState)(!1),[n,a]=(0,o.useState)(!1),[s,l]=(0,o.useState)(null),[c,i]=(0,o.useState)(null),{postId:u,mode:d}=function(){const[e,t]=(0,o.useState)(null),[n,a]=(0,o.useState)("frontend");return(0,o.useEffect)(()=>{const e=window.CAE_Data||{};e.postId&&t(e.postId),e.mode&&a(e.mode)},[]),{postId:e,mode:n}}(),{targetBlock:f,targetMode:p,setPageMode:m,clearTarget:h}=function(){const[e,t]=(0,o.useState)(null),[n,a]=(0,o.useState)(qe);(0,o.useEffect)(()=>{const e=e=>{const n=e.target.closest("[data-ai-block]");if(n){const e=parseInt(n.dataset.aiBlock,10),o=n.dataset.aiLayout,r=n.dataset.aiPostId;t({index:e,layout:o,postId:r}),a(Ke),document.querySelectorAll(".client-module").forEach(e=>{e.classList.remove("cae-block-targeted")}),n.classList.add("cae-block-targeted")}},n=e=>{const t=e.target.closest("[data-ai-block]");t&&t.classList.add("cae-block-hover")},o=e=>{const t=e.target.closest("[data-ai-block]");t&&t.classList.remove("cae-block-hover")},r=e=>{const n=e.detail;n&&(t({index:n.index,layout:n.layout,postId:n.postId||window.CAE_Data?.postId}),a(Ke))};return document.addEventListener("click",e),document.addEventListener("mouseover",n),document.addEventListener("mouseout",o),document.addEventListener("cae:selectBlock",r),()=>{document.removeEventListener("click",e),document.removeEventListener("mouseover",n),document.removeEventListener("mouseout",o),document.removeEventListener("cae:selectBlock",r)}},[]);const r=(0,o.useCallback)(()=>{t(null),a(ze),document.querySelectorAll(".client-module").forEach(e=>{e.classList.remove("cae-block-targeted")})},[]),s=(0,o.useCallback)(()=>{t(null),a(qe),document.querySelectorAll(".client-module").forEach(e=>{e.classList.remove("cae-block-targeted")})},[]);return{targetBlock:e,targetMode:n,setTargetBlock:t,setPageMode:r,clearTarget:s}}(),_=(0,o.useCallback)(async e=>{if(l(e),f)try{const e=await tt(u,f.index);e.success&&i(e.data.fields)}catch(e){console.error("Failed to fetch current block data:",e),i({})}else if(e.modules)try{const t={};for(const n of e.modules){const e=await tt(u,n.index);e.success&&(t[n.index]=e.data.fields)}i(t)}catch(e){console.error("Failed to fetch page blocks data:",e),i({})}else i({});a(!0)},[u,f]),{messages:y,input:E,handleSubmit:b,isLoading:v,setInput:w,stop:I}=function({blockContext:e,postId:t,onShowDiff:n}){const{messages:a,input:s,handleInputChange:l,handleSubmit:c,isLoading:i,stop:u,setInput:d}=function({api:e="/api/chat",id:t,initialMessages:n,initialInput:o="",sendExtraMessageFields:a,experimental_onFunctionCall:s,experimental_onToolCall:l,onToolCall:c,experimental_prepareRequestBody:i,experimental_maxAutomaticRoundtrips:u=0,maxAutomaticRoundtrips:d=u,maxToolRoundtrips:f=d,maxSteps:p=(null!=f?f+1:1),streamMode:m,streamProtocol:h,onResponse:_,onFinish:y,onError:E,credentials:b,headers:v,body:w,generateId:I=g,fetch:k,keepLastMessageOnError:x=!1,experimental_throttle:A}={}){m&&(null!=h||(h="text"===m?"text":void 0));const S=(0,r.useId)(),C=null!=t?t:S,T="string"==typeof e?[e,C]:C,[N]=(0,r.useState)([]),{data:R,mutate:O}=Ve([T,"messages"],null,{fallbackData:null!=n?n:N}),D=(0,r.useRef)(R||[]);(0,r.useEffect)(()=>{D.current=R||[]},[R]);const{data:L,mutate:j}=Ve([T,"streamData"],null),F=(0,r.useRef)(L);(0,r.useEffect)(()=>{F.current=L},[L]);const{data:M=!1,mutate:B}=Ve([T,"loading"],null),{data:P,mutate:V}=Ve([T,"error"],null),J=(0,r.useRef)(null),U=(0,r.useRef)({credentials:b,headers:v,body:w});(0,r.useEffect)(()=>{U.current={credentials:b,headers:v,body:w}},[b,v,w]);const W=(0,r.useCallback)(async t=>{const n=D.current.length;try{B(!0),V(void 0);const n=new AbortController;J.current=n,await async function({getStreamedResponse:e,experimental_onFunctionCall:t,experimental_onToolCall:n,updateChatRequest:o,getCurrentMessages:a}){for(;;){const r=await e();if("messages"in r){let e=!1;for(const s of r.messages)if(void 0!==s.function_call&&"string"!=typeof s.function_call||void 0!==s.tool_calls&&"string"!=typeof s.tool_calls){if(e=!0,t){const n=s.function_call;if("object"!=typeof n){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}const r=await t(a(),n);if(void 0===r){e=!1;break}o(r)}if(n){const t=s.tool_calls;if(!Array.isArray(t)||t.some(e=>"object"!=typeof e)){console.warn("experimental_onToolCall should not be defined when using tools");continue}const r=await n(a(),t);if(void 0===r){e=!1;break}o(r)}}if(!e)break}else{let e=function(e){for(const t of e.messages){if(void 0!==t.tool_calls)for(const e of t.tool_calls)"object"==typeof e&&e.function.arguments&&"string"!=typeof e.function.arguments&&(e.function.arguments=JSON.stringify(e.function.arguments));void 0!==t.function_call&&"object"==typeof t.function_call&&t.function_call.arguments&&"string"!=typeof t.function_call.arguments&&(t.function_call.arguments=JSON.stringify(t.function_call.arguments))}};const s=r;if(!(void 0!==s.function_call&&"string"!=typeof s.function_call||void 0!==s.tool_calls&&"string"!=typeof s.tool_calls))break;if(t){const n=s.function_call;if("object"!=typeof n){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}const r=await t(a(),n);if(void 0===r)break;e(r),o(r)}if(n){const t=s.tool_calls;if("object"!=typeof t){console.warn("experimental_onToolCall should not be defined when using functions");continue}const r=await n(a(),t);if(void 0===r)break;e(r),o(r)}}}}({getStreamedResponse:()=>(async(e,t,n,o,a,r,s,l,c,i,u,d,f,p,m,h,g)=>{var _;const y=s.current;n(t.messages,!1);const E=p?t.messages:t.messages.map(({role:e,content:t,experimental_attachments:n,name:o,data:a,annotations:r,toolInvocations:s,function_call:l,tool_calls:c,tool_call_id:i})=>({role:e,content:t,...void 0!==n&&{experimental_attachments:n},...void 0!==o&&{name:o},...void 0!==a&&{data:a},...void 0!==r&&{annotations:r},...void 0!==s&&{toolInvocations:s},tool_call_id:i,...void 0!==l&&{function_call:l},...void 0!==c&&{tool_calls:c}})),b=a.current;return await Y({api:e,body:null!=(_=null==m?void 0:m({messages:t.messages,requestData:t.data,requestBody:t.body}))?_:{messages:E,data:t.data,...r.current.body,...t.body,...void 0!==t.functions&&{functions:t.functions},...void 0!==t.function_call&&{function_call:t.function_call},...void 0!==t.tools&&{tools:t.tools},...void 0!==t.tool_choice&&{tool_choice:t.tool_choice}},streamProtocol:i,credentials:r.current.credentials,headers:{...r.current.headers,...t.headers},abortController:()=>l.current,restoreMessagesOnFailure(){g||n(y,!1)},onResponse:d,onUpdate(e,a){n([...t.messages,...e],!1),o([...null!=b?b:[],...null!=a?a:[]],!1)},onToolCall:f,onFinish:u,generateId:c,fetch:h})})(e,t,We(O,A),We(j,A),F,U,D,J,I,h,y,_,c,a,i,k,x),experimental_onFunctionCall:s,experimental_onToolCall:l,updateChatRequest:e=>{t=e},getCurrentMessages:()=>D.current}),J.current=null}catch(e){if("AbortError"===e.name)return J.current=null,null;E&&e instanceof Error&&E(e),V(e)}finally{B(!1)}const o=D.current,r=o[o.length-1];o.length>n&&null!=r&&p>1&&Ye(r)&&function(e){let t=0;for(let n=e.length-1;n>=0&&"assistant"===e[n].role;n--)t++;return t}(o)<p&&await W({messages:o})},[O,B,e,U,_,y,E,V,j,F,h,a,s,l,i,c,p,D,J,I,k,x,A]),$=(0,r.useCallback)(async(e,{options:t,functions:n,function_call:o,tools:a,tool_choice:r,data:s,headers:l,body:c,experimental_attachments:i}={})=>{var u,d;e.id||(e.id=I());const f=await $e(i),p={headers:null!=l?l:null==t?void 0:t.headers,body:null!=c?c:null==t?void 0:t.body},m={messages:D.current.concat({...e,id:null!=(u=e.id)?u:I(),createdAt:null!=(d=e.createdAt)?d:new Date,experimental_attachments:f.length>0?f:void 0}),options:p,headers:p.headers,body:p.body,data:s,...void 0!==n&&{functions:n},...void 0!==o&&{function_call:o},...void 0!==a&&{tools:a},...void 0!==r&&{tool_choice:r}};return W(m)},[W,I]),q=(0,r.useCallback)(async({options:e,functions:t,function_call:n,tools:o,tool_choice:a,data:r,headers:s,body:l}={})=>{if(0===D.current.length)return null;const c={headers:null!=s?s:null==e?void 0:e.headers,body:null!=l?l:null==e?void 0:e.body};if("assistant"===D.current[D.current.length-1].role){const e={messages:D.current.slice(0,-1),options:c,headers:c.headers,body:c.body,data:r,...void 0!==t&&{functions:t},...void 0!==n&&{function_call:n},...void 0!==o&&{tools:o},...void 0!==a&&{tool_choice:a}};return W(e)}const i={messages:D.current,options:c,headers:c.headers,body:c.body,data:r,...void 0!==t&&{functions:t},...void 0!==n&&{function_call:n},...void 0!==o&&{tools:o},...void 0!==a&&{tool_choice:a}};return W(i)},[W]),K=(0,r.useCallback)(()=>{J.current&&(J.current.abort(),J.current=null)},[]),z=(0,r.useCallback)(e=>{"function"==typeof e&&(e=e(D.current)),O(e,!1),D.current=e},[O]),G=(0,r.useCallback)(e=>{"function"==typeof e&&(e=e(F.current)),j(e,!1),F.current=e},[j]),[H,Q]=(0,r.useState)(o),X=(0,r.useCallback)(async(e,t={},n)=>{var o,a,r,s,l;if(null==(o=null==e?void 0:e.preventDefault)||o.call(e),!H&&!t.allowEmptySubmit)return;n&&(U.current={...U.current,...n});const c=await $e(t.experimental_attachments),i={headers:null!=(r=t.headers)?r:null==(a=t.options)?void 0:a.headers,body:null!=(l=t.body)?l:null==(s=t.options)?void 0:s.body},u={messages:H||c.length||!t.allowEmptySubmit?D.current.concat({id:I(),createdAt:new Date,role:"user",content:H,experimental_attachments:c.length>0?c:void 0}):D.current,options:i,headers:i.headers,body:i.body,data:t.data};W(u),Q("")},[H,I,W]),Z=({toolCallId:e,result:t})=>{const n=D.current.map((n,o,a)=>o===a.length-1&&"assistant"===n.role&&n.toolInvocations?{...n,toolInvocations:n.toolInvocations.map(n=>n.toolCallId===e?{...n,result:t}:n)}:n);O(n,!1),Ye(n[n.length-1])&&W({messages:n})};return{messages:R||[],setMessages:z,data:L,setData:G,error:P,append:$,reload:q,stop:K,input:H,setInput:Q,handleInputChange:e=>{Q(e.target.value)},handleSubmit:X,isLoading:M,addToolResult:Z,experimental_addToolResult:Z}}({api:`${window.CAE_Data?.ajaxUrl||"/wp-admin/admin-ajax.php"}?action=cae_streaming_chat`,body:{blockContext:e,postId:t,nonce:window.CAE_Data?.nonce||"",language:window.CAE_Data?.language||null,languageName:window.CAE_Data?.languageName||null},onFinish:e=>{try{let t=null,o=null;const a=e.content,r=a.indexOf("{");if(-1!==r){let e=0,s=-1;for(let t=r;t<a.length;t++)if("{"===a[t]&&e++,"}"===a[t]&&e--,0===e){s=t;break}-1!==s&&(t=a.substring(r,s+1),o=JSON.parse(t),(o.fields||o.modules)&&n&&n(o))}}catch(e){console.error("Failed to parse JSON from AI response:",e)}}});return{messages:(0,o.useMemo)(()=>a.map(e=>{if("assistant"===e.role){const t=e.content,n=t.indexOf("{");if(-1!==n){let o=0,a=-1;for(let e=n;e<t.length;e++)if("{"===t[e]&&o++,"}"===t[e]&&o--,0===o){a=e;break}if(-1!==a){const o=(t.substring(0,n).trim()+" "+t.substring(a+1).trim()).trim();return{...e,content:o||"✓ Changes ready for review."}}}}return e}),[a]),input:s,handleSubmit:e=>{e?.preventDefault(),s.trim()&&!i&&c(e)},isLoading:i,setInput:e=>{"string"==typeof e?d(e):l(e)},stop:u}}({blockContext:f,postId:u,onShowDiff:_}),k=(0,o.useCallback)(async e=>{try{let t;t=e.modules?{mode:"page",blocks:e.modules}:{mode:"single",block_index:f?.index,fields:e.fields};const n=await async function(e,t){return et("cae_apply",{post_id:e,changes:t})}(u,t);if(!n.success)throw new Error(n.data?.message||"Failed to apply changes");n.data?.compiled&&console.log("✓ Static blocks recompiled"),setTimeout(()=>{window.location.reload()},500)}catch(e){throw console.error("Apply changes error:",e),e}},[u,f,p]);return(0,o.createElement)("div",{id:"cae-chat-widget",className:e?"cae-expanded":"cae-collapsed"},!e&&(0,o.createElement)("button",{className:"cae-toggle-btn",onClick:()=>t(!0),"aria-label":"Toggle AI Editor"},(0,o.createElement)("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2},(0,o.createElement)("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),(0,o.createElement)("path",{d:"M2 17l10 5 10-5"}),(0,o.createElement)("path",{d:"M2 12l10 5 10-5"}))),e&&(0,o.createElement)("div",{className:"cae-chat-container"},(0,o.createElement)("div",{className:"cae-chat-header"},(0,o.createElement)("div",{className:"cae-header-left"},(0,o.createElement)("h3",null,"AI Editor (beta)")),(0,o.createElement)("div",{className:"cae-header-right"},(0,o.createElement)("button",{className:"cae-clear-btn",onClick:()=>{confirm("Clear conversation history?")&&window.location.reload()},title:"Clear conversation","aria-label":"Clear conversation"},(0,o.createElement)("svg",{width:18,height:18,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2},(0,o.createElement)("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}))),(0,o.createElement)("button",{className:"cae-minimize-btn",onClick:()=>{t(!1)},"aria-label":"Minimize"},(0,o.createElement)("svg",{width:18,height:18,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2},(0,o.createElement)("path",{d:"M19 12H5"}))))),(0,o.createElement)(Xe,{targetBlock:f,targetMode:p,onSetPageMode:m}),(0,o.createElement)(He,{messages:y,isLoading:v}),(0,o.createElement)(Qe,{value:E,onChange:w,onSubmit:b,disabled:p===qe,isLoading:v})),n&&(0,o.createElement)(Ze,{changes:s,currentData:c,postId:u,onClose:()=>a(!1),onApply:k}))}document.addEventListener("DOMContentLoaded",()=>{const e=document.createElement("div");e.id="cae-react-root",document.body.appendChild(e),(0,o.render)((0,o.createElement)(nt),e)})}},n={};function o(e){var a=n[e];if(void 0!==a)return a.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,o),r.exports}o.m=t,e=[],o.O=(t,n,a,r)=>{if(!n){var s=1/0;for(u=0;u<e.length;u++){for(var[n,a,r]=e[u],l=!0,c=0;c<n.length;c++)(!1&r||s>=r)&&Object.keys(o.O).every(e=>o.O[e](n[c]))?n.splice(c--,1):(l=!1,r<s&&(s=r));if(l){e.splice(u--,1);var i=a();void 0!==i&&(t=i)}}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[n,a,r]},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var a,r,[s,l,c]=n,i=0;if(s.some(t=>0!==e[t])){for(a in l)o.o(l,a)&&(o.m[a]=l[a]);if(c)var u=c(o)}for(t&&t(n);i<s.length;i++)r=s[i],o.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return o.O(u)},n=globalThis.webpackChunkclient_ai_editor=globalThis.webpackChunkclient_ai_editor||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=o.O(void 0,[350],()=>o(937));a=o.O(a)})();